{
  "version": "1.0",
  "generated": "2025-12-14",
  "model": "Contoso Sales (Power BI)",
  "description": "Reference values for DAX Bench validation - execute model's DAX and compare results",

  "normalization_rules": {
    "numeric_precision": 4,
    "treat_null_as": "null",
    "comparison_method": "For decimals: round to 4 decimal places before comparing. For integers: exact match. For nulls: null == null is true.",
    "examples": [
      {"expected": 8, "actual": 8.00, "result": "PASS"},
      {"expected": 8.0000, "actual": 8.00001, "result": "PASS (within precision)"},
      {"expected": null, "actual": null, "result": "PASS"},
      {"expected": 100, "actual": 100.0001, "result": "PASS"},
      {"expected": 100, "actual": 101, "result": "FAIL"}
    ]
  },

  "tasks": {
    "task-001": {
      "title": "Total Sales Amount",
      "type": "scalar",
      "reference_dax": "SUM(Sales[Net Price])",
      "expected_value": 721780827.523,
      "tolerance": 0.01
    },
    "task-002": {
      "title": "Count of Customers",
      "type": "scalar",
      "reference_dax": "COUNTROWS(Customer)",
      "expected_value": 88941,
      "tolerance": 0
    },
    "task-003": {
      "title": "Average Unit Price",
      "type": "scalar",
      "reference_dax": "AVERAGE(Sales[Unit Price])",
      "expected_value": 342.9814,
      "tolerance": 0.001
    },
    "task-004": {
      "title": "Distinct Product Count",
      "type": "scalar",
      "reference_dax": "DISTINCTCOUNT(Sales[ProductKey])",
      "expected_value": 2517,
      "tolerance": 0
    },
    "task-005": {
      "title": "Total Order Quantity",
      "type": "scalar",
      "reference_dax": "SUM(Sales[Quantity])",
      "expected_value": 7037283,
      "tolerance": 0
    },
    "task-006": {
      "title": "Year-to-Date Sales",
      "type": "scalar",
      "reference_dax": "TOTALYTD(SUM(Sales[Net Price]), 'Date'[Date])",
      "expected_value": 19867571.5636,
      "tolerance": 0.01,
      "note": "Value depends on date context - this is full model total"
    },
    "task-007": {
      "title": "Previous Year Sales",
      "type": "scalar",
      "reference_dax": "CALCULATE(SUM(Sales[Net Price]), SAMEPERIODLASTYEAR('Date'[Date]))",
      "expected_value": 701913255.9594,
      "tolerance": 0.01
    },
    "task-008": {
      "title": "Sales by Category Filter",
      "type": "scalar",
      "reference_dax": "CALCULATE(SUM(Sales[Net Price]), Product[Category] = \"Audio\")",
      "expected_value": 18882730.3141,
      "tolerance": 0.01
    },
    "task-009": {
      "title": "Year-over-Year Growth Percentage",
      "type": "scalar",
      "reference_dax": "VAR CurrentSales = SUM(Sales[Net Price]) VAR PreviousSales = CALCULATE(SUM(Sales[Net Price]), SAMEPERIODLASTYEAR('Date'[Date])) RETURN DIVIDE(CurrentSales - PreviousSales, PreviousSales)",
      "expected_value": 0.0283,
      "tolerance": 0.0001
    },
    "task-010": {
      "title": "Running Total with CALCULATE and FILTER",
      "type": "scalar",
      "reference_dax": "CALCULATE(SUM(Sales[Net Price]), DATESYTD('Date'[Date]))",
      "expected_value": 19867571.5636,
      "tolerance": 0.01,
      "note": "Equivalent to YTD without date filter context"
    },
    "task-011": {
      "title": "Sales Summary by Category",
      "type": "table",
      "reference_dax": "ADDCOLUMNS(SUMMARIZE(Sales, Product[Category]), \"Total Sales\", CALCULATE(SUM(Sales[Net Price])))",
      "expected_rowcount": 8,
      "validation_method": "rowcount",
      "note": "Verify table has 8 category rows"
    },
    "task-012": {
      "title": "Product List with Renamed Columns",
      "type": "table",
      "reference_dax": "SELECTCOLUMNS(Product, \"Name\", Product[Product Name], \"Brand\", Product[Brand], \"Product Category\", Product[Category])",
      "expected_rowcount": 2517,
      "validation_method": "rowcount"
    },
    "task-013": {
      "title": "Union of High-Value Transactions",
      "type": "table",
      "reference_dax": "UNION(SELECTCOLUMNS(FILTER(Sales, Sales[Net Price] > 1000), \"Order Number\", Sales[Order Number], \"Net Price\", Sales[Net Price], \"Quantity\", Sales[Quantity]), SELECTCOLUMNS(FILTER(Sales, Sales[Quantity] > 10), \"Order Number\", Sales[Order Number], \"Net Price\", Sales[Net Price], \"Quantity\", Sales[Quantity]))",
      "expected_rowcount": 146406,
      "validation_method": "rowcount"
    },
    "task-014": {
      "title": "Year-Category Analysis Matrix",
      "type": "table",
      "reference_dax": "CROSSJOIN(ALL('Date'[Year]), ALL(Product[Category]))",
      "expected_rowcount": 176,
      "validation_method": "rowcount",
      "note": "22 years Ã— 8 categories = 176 rows"
    },
    "task-015": {
      "title": "Product Percentage of Category Total",
      "type": "calculated_column",
      "reference_dax": "VAR ProductSales = CALCULATE(SUM(Sales[Net Price])) VAR CategorySales = CALCULATE(SUM(Sales[Net Price]), ALLEXCEPT(Product, Product[Category])) RETURN DIVIDE(ProductSales, CategorySales) * 100",
      "validation_method": "syntax_and_execute",
      "note": "Calculated column - requires row context, validate by adding to Product table"
    },
    "task-016": {
      "title": "Virtual Relationship with TREATAS",
      "type": "scalar",
      "reference_dax": "VAR ActualSales = SUM(Sales[Net Price]) VAR BudgetAmount = CALCULATE(SUM(Budget[Budget Amount]), TREATAS(VALUES('Date'[Year]), Budget[Year])) RETURN ActualSales - BudgetAmount",
      "expected_value": null,
      "validation_method": "syntax_only",
      "note": "Budget table doesn't exist in Contoso model - validate syntax and TREATAS pattern only"
    },
    "task-017": {
      "title": "Granularity-Aware Measure with VALUES",
      "type": "scalar",
      "reference_dax": "IF(HASONEVALUE('Date'[Year]) && NOT(HASONEVALUE('Date'[Month])), SUM(Sales[Net Price]), IF(HASONEVALUE('Date'[Month]), AVERAGEX(VALUES('Date'[Month]), CALCULATE(SUM(Sales[Net Price]))), SUM(Sales[Net Price])))",
      "expected_value": 721780827.523,
      "tolerance": 0.01,
      "note": "Without filter context, returns total sales"
    },
    "task-018": {
      "title": "Running Count with EARLIER",
      "type": "calculated_column",
      "reference_dax": "COUNTROWS(FILTER(Product, Product[Category] = EARLIER(Product[Category]) && Product[Unit Price] > EARLIER(Product[Unit Price]))) + 1",
      "validation_method": "syntax_and_execute",
      "note": "Calculated column - uses EARLIER which requires row context"
    },
    "task-019": {
      "title": "Multiple Filter Conditions",
      "type": "scalar",
      "reference_dax": "CALCULATE(SUM(Sales[Net Price]), Product[Category] = \"Audio\", Product[Unit Price] > 100)",
      "expected_value": 16090701.4336,
      "tolerance": 0.01
    },
    "task-020": {
      "title": "Percentage of Total with ALLEXCEPT",
      "type": "scalar",
      "reference_dax": "VAR CategorySales = SUM(Sales[Net Price]) VAR YearTotal = CALCULATE(SUM(Sales[Net Price]), ALLEXCEPT('Date', 'Date'[Year]), ALL(Product)) RETURN DIVIDE(CategorySales, YearTotal)",
      "expected_value": 1.0,
      "tolerance": 0.001,
      "note": "Without filter context, category sales = year total, so ratio = 1"
    },
    "task-021": {
      "title": "Filter Intersection with KEEPFILTERS",
      "type": "scalar",
      "reference_dax": "CALCULATE(SUM(Sales[Net Price]), KEEPFILTERS(Product[Category] = \"Audio\"))",
      "expected_value": 18882730.3141,
      "tolerance": 0.01,
      "note": "Without existing category filter, KEEPFILTERS acts like normal filter"
    },
    "task-022": {
      "title": "Product Ranking with RANKX",
      "type": "scalar",
      "reference_dax": "RANKX(ALL(Product), SUM(Sales[Net Price]), , DESC, DENSE)",
      "expected_value": 1,
      "tolerance": 0,
      "note": "Without product filter, evaluates to rank 1 (all products combined)"
    },
    "task-023": {
      "title": "Top 5 Products with TOPN",
      "type": "scalar",
      "reference_dax": "VAR Top5 = TOPN(5, ALL(Product[Product Name]), CALCULATE(SUM(Sales[Net Price])), DESC) VAR CurrentProduct = SELECTEDVALUE(Product[Product Name]) RETURN IF(CurrentProduct IN Top5, SUM(Sales[Net Price]), BLANK())",
      "expected_value": null,
      "tolerance": 0,
      "note": "Without single product selection, returns BLANK"
    },
    "task-024": {
      "title": "90th Percentile Order Value",
      "type": "scalar",
      "reference_dax": "PERCENTILEX.INC(Sales, Sales[Net Price], 0.9)",
      "expected_value": 783.111,
      "tolerance": 0.01
    },
    "task-025": {
      "title": "Handle Missing Data with BLANK",
      "type": "scalar",
      "reference_dax": "IF(ISBLANK(SUM(Sales[Quantity])), 0, SUM(Sales[Quantity]))",
      "expected_value": 7037283,
      "tolerance": 0
    },
    "task-026": {
      "title": "Safe Ratio with Cascading Fallbacks",
      "type": "scalar",
      "reference_dax": "VAR TotalRevenue = SUM(Sales[Net Price]) VAR TotalCost = SUM(Sales[Unit Cost]) VAR RawMargin = DIVIDE(TotalRevenue - TotalCost, TotalRevenue, 0) * 100 RETURN IF(RawMargin < 0, 0, RawMargin)",
      "expected_value": 55.8618,
      "tolerance": 0.01
    },
    "task-027": {
      "title": "Safe Year-over-Year with Missing Data",
      "type": "scalar",
      "reference_dax": "VAR CurrentSales = SUM(Sales[Net Price]) VAR PriorSales = CALCULATE(SUM(Sales[Net Price]), SAMEPERIODLASTYEAR('Date'[Date])) RETURN IF(ISBLANK(CurrentSales), 0, IF(ISBLANK(PriorSales), CurrentSales, CurrentSales - PriorSales))",
      "expected_value": 19867571.5636,
      "tolerance": 0.01,
      "note": "Without date filter, returns Current - Prior (which is YTD of latest year)"
    },
    "task-028": {
      "title": "3-Month Rolling Average",
      "type": "scalar",
      "reference_dax": "DIVIDE(CALCULATE(SUM(Sales[Net Price]), DATESINPERIOD('Date'[Date], MAX('Date'[Date]), -3, MONTH)), 3)",
      "expected_value": null,
      "validation_method": "execute_only",
      "note": "Result depends on date context - validate execution succeeds"
    },
    "task-029": {
      "title": "Same Month Previous Year Comparison",
      "type": "scalar",
      "reference_dax": "CALCULATE(SUM(Sales[Net Price]), SAMEPERIODLASTYEAR('Date'[Date]))",
      "expected_value": 701913255.9594,
      "tolerance": 0.01
    },
    "task-030": {
      "title": "Fiscal Year-to-Date (July Start)",
      "type": "scalar",
      "reference_dax": "CALCULATE(SUM(Sales[Net Price]), DATESYTD('Date'[Date], \"6/30\"))",
      "expected_value": null,
      "validation_method": "execute_only",
      "note": "Result depends on date context - validate execution succeeds"
    }
  },

  "validation_functions": {
    "normalize_numeric": "def normalize(value, precision=4): return round(float(value), precision) if value is not None else None",
    "compare_values": "def compare(expected, actual, tolerance=0.0001): if expected is None and actual is None: return True; if expected is None or actual is None: return False; return abs(expected - actual) <= tolerance"
  }
}
