{
  "id": "task-023",
  "version": "1.0",
  "title": "Top 5 Products with TOPN",
  "description": "Filter to show only the top N products by sales using TOPN.",
  "complexity": "intermediate",
  "category": "table-manipulation",
  "prompt": {
    "system": "You are a DAX expert. Generate only the DAX code without any explanation or markdown formatting. Return the measure definition starting with the name followed by an equals sign.",
    "user": "Create a measure called 'Top 5 Sales' that returns the total Net Price, but ONLY when the current product is among the top 5 products by total sales. For products outside the top 5, return BLANK().",
    "dataModelContext": "You are working with a sales database. Sales contains: Net Price (decimal), ProductKey. Product contains: ProductKey, Product Name. Relationship: Product[ProductKey] 1â†’M Sales[ProductKey]."
  },
  "expectedOutput": {
    "dax": "Top 5 Sales = IF(ISINSCOPE(Product[Product Name]), VAR CurrentProduct = SELECTEDVALUE(Product[Product Name]) VAR Top5Products = TOPN(5, ALL(Product), SUM(Sales[Net Price]), DESC) RETURN IF(CurrentProduct IN SELECTCOLUMNS(Top5Products, \"Name\", Product[Product Name]), SUM(Sales[Net Price]), BLANK()), SUM(Sales[Net Price]))",
    "alternativeCorrect": [
      "Top 5 Sales = VAR Top5 = TOPN(5, ALL(Product[Product Name]), CALCULATE(SUM(Sales[Net Price])), DESC) VAR CurrentProduct = SELECTEDVALUE(Product[Product Name]) RETURN IF(CurrentProduct IN Top5, SUM(Sales[Net Price]), BLANK())",
      "Top 5 Sales = VAR ProductRank = RANKX(ALL(Product), SUM(Sales[Net Price]), , DESC) RETURN IF(ProductRank <= 5, SUM(Sales[Net Price]), BLANK())",
      "Top 5 Sales = CALCULATE(SUM(Sales[Net Price]), TOPN(5, ALL(Product[Product Name]), CALCULATE(SUM(Sales[Net Price])), DESC))"
    ],
    "expectedResult": {
      "columns": ["Product Name", "Top 5 Sales"],
      "rows": [
        {"Product Name": "Top Product 1", "Top 5 Sales": 500000},
        {"Product Name": "Top Product 5", "Top 5 Sales": 250000},
        {"Product Name": "Product Outside Top 5", "Top 5 Sales": null}
      ]
    }
  },
  "evaluationCriteria": {
    "syntaxWeight": 0.3,
    "outputMatchWeight": 0.7,
    "requiredElements": ["TOPN"],
    "partialCreditRules": [
      { "condition": "contains_TOPN", "credit": 0.4 },
      { "condition": "contains_ALL", "credit": 0.2 },
      { "condition": "contains_IF", "credit": 0.2 }
    ],
    "bestPractices": {
      "required": [],
      "preferred": ["VAR", "RETURN"],
      "antiPatterns": []
    },
    "performanceNotes": "TOPN is more efficient than FILTER with RANKX for simple top-N scenarios"
  },
  "hints": [
    "TOPN returns a table of the top N rows",
    "Use IN operator to check if current product is in the top N",
    "Consider using RANKX as an alternative approach"
  ],
  "tags": ["measure", "topn", "ranking", "table-manipulation", "contoso"]
}
