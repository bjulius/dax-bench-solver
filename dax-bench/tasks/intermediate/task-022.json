{
  "id": "task-022",
  "version": "1.0",
  "title": "Product Ranking with RANKX",
  "description": "Rank products by total sales using RANKX with proper ALL context.",
  "complexity": "intermediate",
  "category": "iterator",
  "prompt": {
    "system": "You are a DAX expert. Generate only the DAX code without any explanation or markdown formatting. Return the measure definition starting with the name followed by an equals sign.",
    "user": "Create a measure called 'Sales Rank' that ranks each product by its total Net Price sales. The product with the highest sales should have rank 1. Use dense ranking (no gaps for ties).",
    "dataModelContext": "You are working with a sales database. Sales contains: Net Price (decimal), ProductKey. Product contains: ProductKey, Product Name. Relationship: Product[ProductKey] 1â†’M Sales[ProductKey]."
  },
  "expectedOutput": {
    "dax": "Sales Rank = RANKX(ALL(Product), SUM(Sales[Net Price]), , DESC, DENSE)",
    "alternativeCorrect": [
      "Sales Rank = RANKX(ALL(Product[Product Name]), CALCULATE(SUM(Sales[Net Price])), , DESC, DENSE)",
      "Sales Rank = RANKX(ALLSELECTED(Product), SUM(Sales[Net Price]), , DESC, DENSE)",
      "Sales Rank = VAR CurrentSales = SUM(Sales[Net Price]) RETURN RANKX(ALL(Product), SUM(Sales[Net Price]), CurrentSales, DESC, DENSE)"
    ],
    "expectedResult": {
      "columns": ["Product Name", "Net Price", "Sales Rank"],
      "rows": [
        {"Product Name": "Best Selling Product", "Net Price": 500000, "Sales Rank": 1},
        {"Product Name": "Second Best Product", "Net Price": 450000, "Sales Rank": 2}
      ]
    }
  },
  "evaluationCriteria": {
    "syntaxWeight": 0.3,
    "outputMatchWeight": 0.7,
    "requiredElements": ["RANKX", "ALL"],
    "partialCreditRules": [
      { "condition": "contains_RANKX", "credit": 0.5 },
      { "condition": "contains_ALL", "credit": 0.2 },
      { "condition": "contains_DESC", "credit": 0.15 }
    ],
    "bestPractices": {
      "required": [],
      "preferred": ["DENSE"],
      "antiPatterns": []
    },
    "performanceNotes": "ALL(Product) creates proper ranking context; ALLSELECTED preserves slicer filters"
  },
  "hints": [
    "RANKX needs a table to iterate over - use ALL(Product) for all products",
    "Use DESC for descending order (highest first)",
    "DENSE parameter avoids gaps in rank numbers for ties"
  ],
  "tags": ["measure", "rankx", "ranking", "iterator", "contoso"]
}
