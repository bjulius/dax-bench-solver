{
  "id": "task-016",
  "version": "1.0",
  "title": "Virtual Relationship with TREATAS",
  "description": "Apply filters from one table to another without a physical relationship using TREATAS.",
  "complexity": "advanced",
  "category": "context-transition",
  "prompt": {
    "system": "You are a DAX expert. Generate only the DAX code without any explanation or markdown formatting. Return the measure definition starting with the name followed by an equals sign.",
    "user": "You have a disconnected Budget table with columns: Year (integer) and Budget Amount (decimal). Create a measure called 'Budget vs Actual' that compares actual sales to budget. The measure should return actual Net Price minus the Budget Amount for the same year. Use TREATAS to create a virtual relationship between Budget[Year] and Date[Year].",
    "dataModelContext": "You are working with a sales database. Sales contains: Net Price (decimal), Order Date (date). Date contains: Year (integer). There is also a disconnected Budget table with: Year (integer), Budget Amount (decimal). There is NO physical relationship between Budget and the other tables."
  },
  "expectedOutput": {
    "dax": "Budget vs Actual = VAR ActualSales = SUM(Sales[Net Price]) VAR BudgetAmount = CALCULATE(SUM(Budget[Budget Amount]), TREATAS(VALUES('Date'[Year]), Budget[Year])) RETURN ActualSales - BudgetAmount",
    "alternativeCorrect": [
      "Budget vs Actual = SUM(Sales[Net Price]) - CALCULATE(SUM(Budget[Budget Amount]), TREATAS(VALUES('Date'[Year]), Budget[Year]))",
      "Budget vs Actual = VAR CurrentYear = SELECTEDVALUE('Date'[Year]) VAR ActualSales = SUM(Sales[Net Price]) VAR BudgetAmount = CALCULATE(SUM(Budget[Budget Amount]), Budget[Year] = CurrentYear) RETURN ActualSales - BudgetAmount"
    ],
    "expectedResult": {
      "columns": ["Year", "Budget vs Actual"],
      "rows": [
        {"Year": 2020, "Budget vs Actual": 1234567.89},
        {"Year": 2021, "Budget vs Actual": -234567.12}
      ]
    }
  },
  "evaluationCriteria": {
    "syntaxWeight": 0.3,
    "outputMatchWeight": 0.7,
    "requiredElements": ["TREATAS", "CALCULATE"],
    "partialCreditRules": [
      { "condition": "contains_TREATAS", "credit": 0.4 },
      { "condition": "contains_CALCULATE", "credit": 0.3 },
      { "condition": "contains_VALUES", "credit": 0.2 }
    ],
    "bestPractices": {
      "required": [],
      "preferred": ["VAR", "RETURN", "TREATAS"],
      "antiPatterns": []
    },
    "dimensionWeights": {
      "correctness": 0.45,
      "bestPractices": 0.20,
      "performance": 0.20,
      "clarity": 0.15
    },
    "performanceNotes": "TREATAS is efficient for virtual relationships as it doesn't materialize the relationship"
  },
  "hints": [
    "TREATAS applies the lineage of one column to another, creating a virtual relationship",
    "VALUES returns the distinct values of a column in current filter context",
    "Use CALCULATE to apply the virtual relationship to the Budget calculation"
  ],
  "tags": ["measure", "treatas", "virtual-relationship", "context-transition", "advanced", "contoso"]
}
